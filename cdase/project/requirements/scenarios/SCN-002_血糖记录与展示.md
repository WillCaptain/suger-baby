# Scenario: SCN-002 血糖记录与展示

## 0. Metadata
- ID: SCN-002
- Steward: Will
- Priority: P0
- Version: v0.1
- Last Updated: 2026-01-29
- Status: Draft
- Development Phase: 第一阶段（2周）
- Assigned At: 2026-01-29 20:40

## 1. Background

**用户角色**: 糖尿病患者

**问题陈述**:
- 糖尿病患者需要每天多次测量血糖（空腹、餐前、餐后、睡前等）
- 纸质记录容易丢失，难以追溯历史数据
- 患者需要了解血糖趋势，判断控制效果
- 医生需要查看患者的血糖数据以调整治疗方案

## 2. Core Scenario

### 2.1 手动记录血糖
1. 用户使用血糖仪测量血糖后，打开"糖小稳"应用
2. 点击"记录血糖"按钮
3. 输入血糖值（如：6.5 mmol/L）
4. 选择测量类型：
   - 空腹（fasting）
   - 餐前（before_meal）
   - 餐后（after_meal）
   - 睡前（before_sleep）
   - 随机（random）
5. 系统记录当前时间戳（可手动调整）
6. 可选：添加备注（如："今天吃了甜食"）
7. 保存记录，系统自动关联用户ID

### 2.2 数字人引导录入（与 SCN-004 结合）
8. 用户对数字人医生说："我刚测了血糖6.5"
9. 数字人通过 Function Call 自动调用后端接口保存血糖记录
10. 数字人回复："已为您记录餐后血糖6.5，控制得不错！"

### 2.3 查看血糖记录
11. 用户进入"血糖管理"页面
12. 查看血糖记录列表（按时间倒序）：
    - 显示测量时间、血糖值、测量类型、备注
13. 可按日期范围筛选（如：查看近7天、近30天）
14. 可删除错误的记录

### 2.4 查看血糖统计
15. 用户查看血糖统计信息：
    - 平均血糖值
    - 最高血糖值
    - 最低血糖值
    - 血糖达标率（如：< 7.0 mmol/L 算达标）
16. 可查看不同时间段的统计（今日、近7天、近30天）

## 3. Expected Outcomes

### 用户视角
- ✅ 快速记录血糖数据，操作不超过 3 步
- ✅ 查看历史记录，支持时间范围筛选
- ✅ 看到统计数据，了解血糖控制趋势
- ✅ 错误记录可删除

### 系统视角
- ✅ 每条记录唯一 ID（UUID）
- ✅ 血糖值精度：小数点后 1 位（如：6.5）
- ✅ 记录列表分页展示（每页 20 条）
- ✅ 统计计算准确（平均值、最高、最低）
- ✅ 支持访客和正式用户记录

## 4. Constraints & Rules

### 业务规则
1. **血糖值范围校验**：
   - 最小值：1.0 mmol/L
   - 最大值：33.3 mmol/L（超过此值为异常输入）
   - 超出范围时提示用户重新输入
   
2. **测量类型必填**：
   - 必须指定测量类型（空腹/餐前/餐后等）
   - 默认为"随机"
   
3. **数据归属**：
   - 访客记录的数据，转正后自动归属到正式账号
   - 每条记录必须关联用户ID

### 不变量（Invariants）
- **时间有效性**：测量时间不能晚于当前时间
- **数据完整性**：删除用户时，血糖记录不删除（软删除或迁移）

### 边缘情况
1. **重复记录**：
   - 同一分钟内多次记录，系统允许（不去重）
   - 由用户自行判断和删除

2. **批量导入**：
   - P1 阶段支持从血糖仪导入历史数据（批量创建接口）

## 5. Evolution Hint

**全新能力**。

**未来演进**：
- P1: 批量导入血糖数据（从设备）
- P1: 血糖趋势图表展示（折线图）
- P2: 血糖异常预警（连续高血糖提醒）
- P2: 与医生共享血糖数据

---

**关联模块**: 血糖管理模块
**依赖场景**: SCN-001（用户身份）、SCN-004（数字人引导）

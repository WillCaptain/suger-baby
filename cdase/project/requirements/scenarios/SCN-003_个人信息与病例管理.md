# Scenario: SCN-003 个人信息与病例管理

## 0. Metadata
- ID: SCN-003
- Steward: hangxiao
- Priority: P0
- Version: v0.1
- Last Updated: 2026-01-29
- Status: Draft
- Development Phase: 第一阶段（2周）

## 1. Background

**用户角色**: 糖尿病患者（正式用户）

**问题陈述**:
- 用户转正后，需要完善个人信息和病史
- 数字人医生需要了解用户的健康状况，才能提供个性化建议
- 敏感信息（姓名、电话、身份证、病史）必须加密存储，符合隐私保护法规
- 用户希望随时查看和修改自己的信息

## 2. Core Scenario

### 2.1 数字人引导录入个人信息（推荐方式）
1. 用户首次转正后，数字人医生主动问候：
   "您好，我是徐医生。为了更好地为您服务，请允许我了解一些基本信息。"
2. 数字人逐项询问：
   - "请问怎么称呼您？"（真实姓名）
   - "您的性别是？"（男/女）
   - "今年多大年龄？"（年龄）
   - "方便留个联系电话吗？"（手机号，可跳过）
3. 用户通过对话回答，数字人通过 Function Call 自动保存
4. 数字人确认："好的，已记录您的信息。"

### 2.2 数字人引导录入病例信息
5. 数字人继续询问病史：
   - "您是何时确诊糖尿病的？"（患病时间）
   - "您的糖尿病类型是？"（1型/2型）
   - "最近一次测血压是多少？"（收缩压/舒张压）
   - "您目前在服用哪些药物？"（用药情况）
   - "有其他疾病史吗？"（并发症、家族史等）
6. 用户回答，数字人自动保存病例信息
7. 所有敏感信息（姓名、电话、身份证、病史详情）加密存储

### 2.3 手动更新个人信息
8. 用户进入"个人中心"页面
9. 点击"编辑资料"
10. 修改基本信息：
    - 姓名、性别、年龄、联系方式、身份证号
11. 保存后，系统加密存储更新的信息

### 2.4 手动更新病例信息
12. 用户进入"健康档案"页面
13. 点击"编辑病例"
14. 修改病史信息：
    - 患病时间、糖尿病类型、血压、用药情况、并发症等
15. 保存后，系统加密存储病例信息

### 2.5 查看信息
16. 用户随时可查看自己的个人信息和病例（系统自动解密展示）
17. 脱敏展示：电话号码显示为 138****5678

## 3. Expected Outcomes

### 用户视角
- ✅ 通过对话方式自然完成信息录入，体验友好
- ✅ 手动编辑方式提供精确控制
- ✅ 敏感信息加密存储，隐私受保护
- ✅ 查看信息时脱敏展示

### 系统视角
- ✅ 所有敏感字段（姓名、电话、身份证、病史）使用 AES-256-GCM 加密
- ✅ 手机号和身份证生成哈希索引，支持查询
- ✅ 病例信息存储在独立表 `tbl_medical_history`
- ✅ 修改操作记录审计日志

## 4. Constraints & Rules

### 业务规则
1. **强制字段**：
   - 姓名（必填）
   - 性别（必填）
   - 年龄（必填）
   
2. **可选字段**：
   - 联系方式、身份证号、病例信息（用户可跳过）
   
3. **隐私协议**：
   - 保存敏感信息前，必须确认用户已同意隐私协议
   
4. **访客限制**：
   - 访客不能编辑个人信息（仅正式用户可编辑）

### 不变量（Invariants）
- **加密一致性**：所有敏感字段必须加密存储，不能有明文泄漏
- **解密权限**：只有用户本人可查看解密后的完整信息

### 边缘情况
1. **信息更新频率**：
   - 个人信息（姓名、性别等）较少修改
   - 病例信息（血压、用药）可能频繁更新
   
2. **数据导出**：
   - P2 阶段支持用户导出自己的完整健康档案

## 5. Evolution Hint

**全新能力**。

**未来演进**：
- P1: 支持上传身份证照片，自动识别并填充信息
- P1: 支持导入体检报告（PDF/图片），自动提取病史
- P2: 与医疗机构打通，自动同步病历数据

---

**关联模块**: 用户模块、安全模块
**依赖场景**: SCN-001（用户转正）、SCN-004（数字人引导）

# Scenario: SCN-005 饮食拍照识别与记录

## 0. Metadata
- ID: SCN-005
- Steward: Ronny
- Priority: P0
- Version: v0.1
- Last Updated: 2026-01-31
- Status: Draft
- Development Phase: 第三阶段（3周）

## 1. Background

**用户角色**: 糖尿病患者

**问题陈述**:
- 糖尿病患者需要控制饮食，了解每餐的热量和营养成分
- 手动输入食物信息繁琐，用户容易放弃
- 患者对食物营养成分不了解，难以准确估算
- 需要简单快捷的方式记录饮食

## 2. Core Scenario

### 2.1 拍照识别饮食（核心功能）
1. 用户吃饭前，点击"记录饮食"按钮
2. 选择"拍照识别"
3. 拍摄食物照片（或从相册选择）
4. 照片上传到 OSS
5. **AI 识别开始**：
   - 调用阿里百炼视觉识别接口
   - 识别食物种类（如：米饭、炒鸡蛋、西兰花）
   - 估算食物重量（如：米饭 200g、鸡蛋 100g）
   - 计算营养成分：
     - 总热量（千卡）
     - 碳水化合物（克）
     - 蛋白质（克）
     - 脂肪（克）
6. **识别结果展示**：
   - 显示食物列表和营养成分
   - 用户可手动修正：
     - 修改食物名称
     - 调整重量
     - 添加或删除食物项
7. 用户确认后保存记录

### 2.2 文字描述记录饮食
8. 用户也可选择"文字描述"方式
9. 输入食物描述，例如："一碗米饭、炒鸡蛋、西兰花"
10. 系统根据描述估算营养成分（使用食物数据库）
11. 保存记录

### 2.3 数字人引导记录（与 SCN-004 结合）
12. 用户对数字人说："我刚吃了午饭"
13. 数字人引导："方便拍张照片吗？我帮您分析一下营养。"
14. 用户发送照片，数字人自动识别并保存
15. 数字人反馈："您这餐摄入了约 650 千卡，碳水 80g，建议餐后测一下血糖。"

### 2.4 查看饮食记录
16. 用户进入"饮食管理"页面
17. 查看历史饮食记录（按时间倒序）：
    - 显示照片缩略图
    - 显示食物名称和营养摘要
18. 可按日期范围筛选
19. 可查看详细营养成分分解

### 2.5 查看今日摄入统计
20. 用户查看"今日摄入"：
    - 总热量（如：1500 / 2000 千卡）
    - 碳水化合物（如：180g）
    - 蛋白质（如：60g）
    - 脂肪（如：40g）
21. 显示建议摄入量对比（基于用户的年龄、性别、活动量）

## 3. Expected Outcomes

### 用户视角
- ✅ 拍照即可记录，操作简单快捷
- ✅ AI 自动识别食物和营养成分，无需手动查询
- ✅ 可手动修正识别结果，保证准确性
- ✅ 查看今日摄入统计，了解饮食控制情况

### 系统视角
- ✅ 照片上传到 OSS，生成永久访问链接
- ✅ 调用阿里百炼视觉识别 API
- ✅ 识别结果存储到数据库（JSONB 格式）
- ✅ 营养成分计算基于标准食物数据库
- ✅ 今日摄入实时聚合计算

## 4. Constraints & Rules

### 业务规则
1. **照片要求**：
   - 格式：JPG/PNG
   - 大小：≤ 10 MB
   - 建议分辨率：≥ 800x600
   
2. **识别准确性**：
   - AI 识别可能不准确，必须允许用户手动修正
   - 用户修正后的数据用于反馈优化模型（P2 阶段）
   
3. **营养计算标准**：
   - 使用中国食物成分表（China Food Composition Table）
   - 营养成分保留 1 位小数
   
4. **访客限制**：
   - 访客可以拍照识别，但记录数量限制（如：最多 10 条）
   - 转正后无限制

### 不变量（Invariants）
- **照片关联性**：每条饮食记录必须关联照片 URL（文字描述除外）
- **时间有效性**：记录时间不能晚于当前时间

### 边缘情况
1. **识别失败**：
   - 照片模糊或食物无法识别时，提示用户重新拍摄或手动输入
   
2. **多食物识别**：
   - 一张照片包含多种食物（如：一桌菜），分别识别并列出
   
3. **复杂食物**：
   - 对于复合菜品（如：宫保鸡丁），估算总营养成分

## 5. Evolution Hint

**全新能力**。

**未来演进**：
- P1: 支持视频识别（录制吃饭视频，自动统计）
- P1: 个性化营养建议（基于血糖数据和饮食记录）
- P2: 食物数据库众包（用户贡献食物营养数据）
- P2: 餐厅菜单识别（扫描菜单，推荐低糖菜品）

---

**关联模块**: 饮食管理模块、文件上传模块、阿里百炼集成
**依赖场景**: SCN-001（用户身份）、SCN-004（数字人引导）
**关键技术**: OSS 文件上传、阿里百炼视觉识别、营养成分计算

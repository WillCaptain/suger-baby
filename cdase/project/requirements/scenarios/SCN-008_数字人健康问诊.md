# Scenario: SCN-008 数字人健康问诊

## 0. Metadata
- ID: SCN-008
- Steward: hangxiao
- Priority: P0
- Version: v0.1
- Last Updated: 2026-01-29
- Status: Draft
- Development Phase: 第四阶段（2周）

## 1. Background

**用户角色**: 糖尿病患者

**问题陈述**:
- 糖尿病患者在日常生活中遇到健康问题，想快速获得专业建议
- 线下就医成本高、等待时间长
- 普通健康咨询不需要去医院，AI 医生可以提供初步建议
- 用户希望问诊过程自然流畅，像和真人医生交流

## 2. Core Scenario

### 2.1 发起问诊
1. 用户进入"徐医生"数字人界面
2. 点击"健康问诊"按钮（或直接提问）
3. 系统创建问诊会话（关联用户ID和历史健康数据）
4. 徐医生问候："您好，请问有什么健康问题需要咨询？"

### 2.2 问诊对话
5. 用户描述症状或问题：
   - 例1："我最近血糖总是偏高，怎么回事？"
   - 例2："糖尿病可以吃水果吗？"
   - 例3："我感觉头晕，是不是低血糖？"
6. **数字人智能分析**：
   - 调用阿里百炼 AI，结合医疗知识库
   - 查询用户历史数据（最近血糖记录、饮食记录等）
   - 上下文理解，支持多轮对话追问
7. 数字人给出专业建议：
   - 可能的原因分析
   - 生活方式调整建议
   - 是否需要就医建议
   - 相关知识科普

### 2.3 多轮深入问诊
8. 数字人可能追问细节：
   - "您最近有改变饮食习惯吗？"
   - "您的用药情况有变化吗？"
   - "这种情况持续多久了？"
9. 用户回答，数字人基于新信息调整建议
10. 问诊过程完整记录，保存到问诊记录表

### 2.4 查询历史健康数据
11. 问诊过程中，数字人可通过 Function Call 查询：
    - 用户最近 7 天血糖记录
    - 用户最近饮食摄入情况
    - 用户运动记录
12. 基于真实数据给出个性化建议

### 2.5 问诊记录保存
13. 问诊结束后，系统生成问诊记录：
    - 主诉（用户描述的问题）
    - 问诊对话内容
    - 徐医生的建议摘要
    - 问诊时间
14. 用户可随时查看历史问诊记录

### 2.6 紧急情况处理
15. 如果识别到紧急情况（如：严重低血糖、酮症酸中毒）：
    - 数字人立即提醒："您的情况可能较严重，建议立即就医！"
    - 显示急救指引
    - 提供医院地图导航（P1 阶段）

## 3. Expected Outcomes

### 用户视角
- ✅ 随时随地发起问诊，无需预约等待
- ✅ 对话式问诊体验自然流畅
- ✅ 获得专业、个性化的健康建议
- ✅ 紧急情况得到及时提醒
- ✅ 问诊记录可追溯

### 系统视角
- ✅ 问诊会话独立管理（与普通对话区分）
- ✅ 调用医疗知识库（糖尿病专业知识）
- ✅ 支持查询用户历史健康数据
- ✅ 问诊记录持久化存储
- ✅ 敏感词和医疗免责声明处理

## 4. Constraints & Rules

### 业务规则
1. **免费问诊限制**：
   - P0 阶段：数字人问诊完全免费（AI 自动回答）
   - P1 阶段：引入付费的"图文问诊"（真人医生）
   
2. **问诊范围**：
   - 仅限糖尿病相关健康咨询
   - 不能诊断疾病、不能开处方
   - 超出范围的问题，引导用户线下就医
   
3. **隐私保护**：
   - 问诊记录加密存储
   - 仅用户本人可查看
   
4. **访客限制**：
   - 访客可以问诊，但无法查询历史健康数据
   - 正式用户问诊更个性化

### 不变量（Invariants）
- **免责声明**：每次问诊开始时，显示医疗免责声明
- **记录完整性**：所有问诊对话必须完整保存

### 边缘情况
1. **敏感词过滤**：
   - AI 回复不能包含诊断性语言（如："您得了XX病"）
   - 必须使用建议性语言（如："可能是XX原因，建议咨询医生"）
   
2. **知识库更新**：
   - 医疗知识库需定期更新（遵循最新医疗指南）
   
3. **异常输入**：
   - 用户输入无关内容（如：闲聊、骂人），数字人礼貌引导回正题

## 5. Evolution Hint

**全新能力**。

**未来演进**：
- P1: 图文问诊（付费，真人医生接诊）→ 见 SCN-009
- P1: 问诊后推荐相关健康文章或视频
- P2: 多科室问诊（内分泌、营养、心理等）
- P2: 问诊报告导出（PDF 格式，可分享给线下医生）

---

**关联模块**: 问诊模块、数字人模块、阿里百炼集成
**依赖场景**: SCN-004（数字人对话）、SCN-002（血糖数据查询）、SCN-005（饮食数据查询）
**关键技术**: 医疗知识库、敏感词过滤、紧急情况识别

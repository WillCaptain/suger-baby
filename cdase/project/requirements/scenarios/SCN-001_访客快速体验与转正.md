# Scenario: SCN-001 访客快速体验

## 0. Metadata
- ID: SCN-001
- Steward: hangxiao
- Priority: P0
- Version: v0.2
- Last Updated: 2026-01-29 21:30
- Status: **In Progress** (需求分析完成，准备进入设计阶段)
- Development Phase: 第一阶段（2周）
- Change Log: v0.2 - 简化范围，移除令牌策略和用户转正逻辑，仅保留访客ID生成
- Git Commit: a98f8dd - "feat: Initialize CDASE project and simplify SCN-001 scope"

## 1. Background

**用户角色**: 潜在用户（未注册的糖尿病患者或关注者）

**问题陈述**:
- 用户首次打开"糖小稳" Android 应用，想快速了解产品功能
- 传统注册流程复杂，需要填写手机号、验证码等，导致用户流失
- Showcase 演示场景需要快速展示产品能力，不能让注册成为障碍
- 需要一个临时的访客身份来标识用户，记录其使用数据

## 2. Core Scenario

### 2.1 访客身份生成
1. 用户打开 Android 应用，系统检测到用户无访客ID
2. 系统自动生成临时访客身份（Guest ID），格式：`GUEST_<timestamp>_<random>`
3. 将访客ID存储到本地（Android SharedPreferences）
4. 访客ID关联到该设备，用户可立即使用核心功能：
   - 与数字人医生（徐医生）对话
   - 记录血糖数据
   - 记录饮食信息
   - 记录运动数据
   - 查看健康数据展示
5. 所有访客数据正常保存到数据库，关联访客ID

## 3. Expected Outcomes

### 用户视角
- ✅ 首次访问无需注册，即刻体验所有核心功能
- ✅ 访客ID自动生成，用户无感知
- ✅ 同一设备重复访问，使用相同访客ID，数据持续可见

### 系统视角
- ✅ 每个访客生成唯一的 Guest ID（格式：`GUEST_<timestamp>_<random>`）
- ✅ 访客ID存储在本地，无过期时间
- ✅ 访客数据正常保存到数据库，关联访客ID
- ✅ 访客可使用除付费功能外的所有核心功能

## 4. Constraints & Rules

### 业务规则
1. **访客限制**：
   - 访客不能使用付费功能（如图文问诊）
   - 访客可使用所有免费核心功能
   
2. **访客ID唯一性**：
   - 每个设备生成唯一的访客ID
   - 访客ID一旦生成，长期有效（除非用户清除缓存）
   
3. **数据归属**：
   - 所有数据通过 `user_id` 关联访客ID
   - 访客数据标记为 `user_type = 'guest'`

### 不变量（Invariants）
- **ID唯一性**：每个访客ID在系统中唯一
- **数据完整性**：访客数据必须关联有效的访客ID

### 边缘情况
1. **清除应用数据**：
   - 用户清除 Android 应用数据后，访客ID丢失
   - 再次打开应用会生成新的访客ID
   - 旧访客ID的数据仍保留在数据库中，但用户无法访问
   
2. **多设备访问**：
   - 不同设备生成不同访客ID
   - 每个设备的数据独立存储

## 5. Evolution Hint

**这是全新的能力**，专为"糖小稳"的 Showcase 演示设计。

**未来可能的演进**：
- **P1 阶段：用户转正功能**（手机号+验证码登录，数据迁移） - 已规划但暂不实现
- **P1 阶段：令牌认证体系** - 已规划但暂不实现
- **P1 阶段：隐私协议管理** - 已规划但暂不实现
- P2 阶段：支持更多登录方式（微信开放平台）
- P2 阶段：访客数据可导出

---

**关联模块**: 用户模块
**依赖的外部服务**: 无

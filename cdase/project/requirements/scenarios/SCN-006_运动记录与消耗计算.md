# Scenario: SCN-006 运动记录与消耗计算

## 0. Metadata
- ID: SCN-006
- Steward: hangxiao
- Priority: P0
- Version: v0.1
- Last Updated: 2026-01-29
- Status: Draft
- Development Phase: 第三阶段（3周）

## 1. Background

**用户角色**: 糖尿病患者

**问题陈述**:
- 糖尿病患者需要通过运动控制血糖
- 用户想知道运动消耗了多少热量，是否达到目标
- 运动记录帮助患者建立良好的运动习惯
- 医生需要了解患者的运动情况

## 2. Core Scenario

### 2.1 记录运动
1. 用户完成运动后，点击"记录运动"按钮
2. 选择运动类型：
   - 跑步（running）
   - 快走（walking）
   - 骑行（cycling）
   - 游泳（swimming）
   - 瑜伽（yoga）
   - 其他（other）
3. 输入运动时长（分钟）
4. 可选：输入运动强度（低/中/高）
5. 保存记录

### 2.2 卡路里消耗自动计算
6. 系统根据以下因素计算卡路里消耗：
   - 运动类型
   - 运动时长
   - 用户体重（从个人信息获取）
   - 运动强度
7. 计算公式示例：
   - 跑步：消耗 = 体重(kg) × 时长(分钟) × 0.15
   - 快走：消耗 = 体重(kg) × 时长(分钟) × 0.08
   - 其他运动类似
8. 显示消耗结果："您消耗了约 350 千卡"

### 2.3 数字人引导记录（与 SCN-004 结合）
9. 用户对数字人说："我刚跑步30分钟"
10. 数字人通过 Function Call 自动保存运动记录
11. 数字人计算并反馈："很棒！您消耗了约 300 千卡。建议半小时后测血糖。"

### 2.4 查看运动记录
12. 用户进入"运动管理"页面
13. 查看历史运动记录（按时间倒序）：
    - 显示运动类型、时长、消耗热量
14. 可按日期范围筛选

### 2.5 查看运动统计
15. 用户查看运动统计：
    - 今日运动时长（分钟）
    - 今日消耗热量（千卡）
    - 本周运动天数
    - 本周总消耗
16. 显示运动目标达成情况（如：每周运动 5 次）

## 3. Expected Outcomes

### 用户视角
- ✅ 快速记录运动，操作不超过 3 步
- ✅ 自动计算卡路里消耗，无需手动查表
- ✅ 查看运动历史和统计，了解运动习惯
- ✅ 数字人引导记录，体验流畅

### 系统视角
- ✅ 运动记录存储到数据库
- ✅ 消耗计算基于标准 MET 值（代谢当量）
- ✅ 支持访客和正式用户记录
- ✅ 统计数据实时聚合

## 4. Constraints & Rules

### 业务规则
1. **运动时长范围**：
   - 最小值：1 分钟
   - 最大值：300 分钟（5 小时）
   - 超出范围提示用户
   
2. **体重要求**：
   - 卡路里计算依赖用户体重
   - 如果用户未填写体重，使用默认值（70kg）并提示完善
   
3. **运动强度默认值**：
   - 未指定时，默认为"中等强度"
   
4. **访客限制**：
   - 访客可记录运动，但记录数量限制（如：最多 10 条）

### 不变量（Invariants）
- **时间有效性**：运动时间不能晚于当前时间
- **消耗非负**：卡路里消耗必须 ≥ 0

### 边缘情况
1. **未知运动类型**：
   - 用户选择"其他"时，使用平均消耗率估算
   
2. **高强度运动**：
   - 对于高强度运动，消耗计算乘以系数（如：1.5 倍）

## 5. Evolution Hint

**全新能力**。

**未来演进**：
- P1: 接入智能手环/手表数据（自动同步运动记录）
- P1: 运动计划推荐（基于用户健康状况）
- P2: 运动打卡和激励机制（连续运动奖励）
- P2: 运动社区（用户分享运动心得）

---

**关联模块**: 运动消耗模块
**依赖场景**: SCN-001（用户身份）、SCN-003（个人信息 - 体重）、SCN-004（数字人引导）

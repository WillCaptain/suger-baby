# ä»£ç éªŒè¯æŠ¥å‘Š - FTR-001

**éªŒè¯æ—¶é—´**: 2026-01-30  
**éªŒè¯èŒƒå›´**: FTR-001 è®¿å®¢IDç”Ÿæˆä¸ç®¡ç†åŠŸèƒ½

---

## âœ… ä»£ç ç»“æ„éªŒè¯

### 1. é¡¹ç›®ç»“æ„ âœ…

```
âœ… settings.gradle.kts - é¡¹ç›®è®¾ç½®æ–‡ä»¶å­˜åœ¨
âœ… build.gradle.kts - æ ¹æ„å»ºæ–‡ä»¶å­˜åœ¨
âœ… gradle.properties - Gradle å±æ€§æ–‡ä»¶å­˜åœ¨
âœ… gradlew.bat - Windows Gradle wrapper å­˜åœ¨
```

### 2. Shared æ¨¡å—ç»“æ„ âœ…

```
âœ… shared/build.gradle.kts - æ¨¡å—é…ç½®å­˜åœ¨
âœ… shared/src/commonMain/ - è·¨å¹³å°ä»£ç ç›®å½•å­˜åœ¨
âœ… shared/src/androidMain/ - Android å®ç°ç›®å½•å­˜åœ¨
âœ… shared/src/commonTest/ - æµ‹è¯•ä»£ç ç›®å½•å­˜åœ¨
```

### 3. Android åº”ç”¨ç»“æ„ âœ…

```
âœ… androidApp/build.gradle.kts - åº”ç”¨é…ç½®å­˜åœ¨
âœ… androidApp/src/main/AndroidManifest.xml - æ¸…å•æ–‡ä»¶å­˜åœ¨
âœ… androidApp/src/main/kotlin/ - Kotlin ä»£ç ç›®å½•å­˜åœ¨
âœ… androidApp/src/androidTest/ - é›†æˆæµ‹è¯•ç›®å½•å­˜åœ¨
```

---

## âœ… ä»£ç è¯­æ³•éªŒè¯

### 1. Shared Module - commonMain âœ…

#### `GuestIdManager.kt`
- âœ… åŒ…åæ­£ç¡®: `com.twelfth.data.local`
- âœ… ç±»å®šä¹‰æ­£ç¡®: `class GuestIdManager(private val localStorage: ILocalStorage)`
- âœ… FUN-001 å®ç°: `fun detectGuestId(): String?`
- âœ… FUN-002 å®ç°: `fun generateGuestId(): String`
- âœ… æ­£åˆ™è¡¨è¾¾å¼æ­£ç¡®: `^GUEST_\\d{13}_[a-z0-9]{8}$`
- âœ… å¼‚å¸¸å¤„ç†å®Œæ•´
- âœ… expect å‡½æ•°å£°æ˜: `expect fun currentTimeMillis(): Long`

#### `ILocalStorage.kt`
- âœ… æ¥å£å®šä¹‰æ­£ç¡®
- âœ… ä¸‰ä¸ªæ–¹æ³•ç­¾åæ­£ç¡®: `getString`, `setString`, `remove`

#### `LocalStorage.kt`
- âœ… expect ç±»å£°æ˜æ­£ç¡®: `expect class LocalStorage : ILocalStorage`

#### `StorageException.kt`
- âœ… å¼‚å¸¸ç±»ç»§æ‰¿ Exception
- âœ… æ„é€ å‡½æ•°å‚æ•°æ­£ç¡®

### 2. Shared Module - androidMain âœ…

#### `LocalStorage.android.kt`
- âœ… actual ç±»å®ç°æ­£ç¡®: `actual class LocalStorage(context: Context) : ILocalStorage`
- âœ… SharedPreferences ä½¿ç”¨æ­£ç¡®
- âœ… å­˜å‚¨åç§°: `twelfth_prefs`
- âœ… ä½¿ç”¨ `commit()` åŒæ­¥å†™å…¥
- âœ… å¼‚å¸¸å¤„ç†å®Œæ•´

#### `TimeUtils.android.kt`
- âœ… actual å‡½æ•°å®ç°: `actual fun currentTimeMillis(): Long`
- âœ… ä½¿ç”¨ `System.currentTimeMillis()`

### 3. Android Application âœ…

#### `MainActivity.kt`
- âœ… åŒ…åæ­£ç¡®: `com.twelfth.android`
- âœ… ç»§æ‰¿ ComponentActivity
- âœ… åˆå§‹åŒ– GuestIdManager æ­£ç¡®
- âœ… FTR-001 æµç¨‹å®ç°æ­£ç¡®
- âœ… Compose UI ä»£ç è¯­æ³•æ­£ç¡®
- âœ… ä½¿ç”¨ Material 3 ç»„ä»¶

#### `Theme.kt` & `Type.kt`
- âœ… Compose ä¸»é¢˜å®šä¹‰æ­£ç¡®
- âœ… é¢œè‰²æ–¹æ¡ˆç¬¦åˆè®¾è®¡ï¼ˆç²‰è‰²æ¸©æš–ç³»ï¼‰

### 4. æµ‹è¯•ä»£ç  âœ…

#### `GuestIdManagerDetectTest.kt`
- âœ… åŒ…åæ­£ç¡®
- âœ… ä½¿ç”¨ `kotlin.test` æ¡†æ¶
- âœ… 4ä¸ªæµ‹è¯•ç”¨ä¾‹è¦†ç›–æ‰€æœ‰ AC
- âœ… MockLocalStorage å®ç°æ­£ç¡®

#### `GuestIdManagerGenerateTest.kt`
- âœ… 5ä¸ªæµ‹è¯•ç”¨ä¾‹è¦†ç›–æ‰€æœ‰ AC
- âœ… å”¯ä¸€æ€§æµ‹è¯•é€»è¾‘æ­£ç¡®
- âœ… æ ¼å¼éªŒè¯æµ‹è¯•æ­£ç¡®

#### `FTR001GuestIdGenerationTest.kt`
- âœ… Feature çº§åˆ«æµ‹è¯•
- âœ… 7ä¸ªæµ‹è¯•ç”¨ä¾‹è¦†ç›–æ‰€æœ‰ FAC
- âœ… å®Œæ•´ç”¨æˆ·æµç¨‹æµ‹è¯•å­˜åœ¨

#### `LocalStorageTest.kt`
- âœ… Android é›†æˆæµ‹è¯•
- âœ… ä½¿ç”¨ AndroidX Test æ¡†æ¶
- âœ… 6ä¸ªæµ‹è¯•ç”¨ä¾‹è¦†ç›– SharedPreferences

---

## âœ… é…ç½®æ–‡ä»¶éªŒè¯

### 1. Gradle é…ç½® âœ…

#### `settings.gradle.kts`
```kotlin
âœ… rootProject.name = "TangXiaoWen"
âœ… include(":androidApp")
âœ… include(":shared")
```

#### `build.gradle.kts` (root)
```kotlin
âœ… Android Gradle Plugin: 8.2.0
âœ… Kotlin: 1.9.20
âœ… clean task å®šä¹‰æ­£ç¡®
```

#### `shared/build.gradle.kts`
```kotlin
âœ… kotlin("multiplatform") æ’ä»¶
âœ… com.android.library æ’ä»¶
âœ… androidTarget é…ç½®æ­£ç¡®
âœ… sourceSets é…ç½®å®Œæ•´
âœ… ä¾èµ–é¡¹æ­£ç¡®: kotlinx-coroutines-core 1.7.3
```

#### `androidApp/build.gradle.kts`
```kotlin
âœ… com.android.application æ’ä»¶
âœ… kotlin("android") æ’ä»¶
âœ… minSdk: 24
âœ… targetSdk: 34
âœ… Compose é…ç½®æ­£ç¡®
âœ… ä¾èµ–é¡¹å®Œæ•´: Compose BOM, Material 3
```

### 2. Android èµ„æº âœ…

#### `AndroidManifest.xml`
```xml
âœ… package: com.twelfth.android
âœ… MainActivity æ³¨å†Œæ­£ç¡®
âœ… LAUNCHER intent-filter å­˜åœ¨
âœ… ä¸»é¢˜é…ç½®æ­£ç¡®
```

#### `strings.xml`
```xml
âœ… app_name: ç³–å°ç¨³
```

---

## âœ… è®¾è®¡çº¦å®šç¬¦åˆæ€§æ£€æŸ¥

### Convention éµå®ˆæƒ…å†µ âœ…

| ID | çº¦å®š | çŠ¶æ€ | è¯´æ˜ |
|----|------|------|------|
| 1 | æ–‡æ¡£å’Œæ³¨é‡Šä½¿ç”¨ç®€ä½“ä¸­æ–‡ | âœ… | æ‰€æœ‰æ³¨é‡Šå‡ä¸ºä¸­æ–‡ |
| 6 | åŒ…åä½¿ç”¨ `com.twelfth` | âœ… | æ‰€æœ‰åŒ…åç¬¦åˆè§„èŒƒ |
| 13 | ä½¿ç”¨ KMM æ¶æ„ | âœ… | é¡¹ç›®ä½¿ç”¨ KMM ç»“æ„ |

### API/SPI å¥‘çº¦ âœ…

#### FUN-001: detectGuestId()
```kotlin
âœ… æ–¹æ³•ç­¾å: fun detectGuestId(): String?
âœ… è¿”å›ç±»å‹æ­£ç¡®
âœ… æ ¼å¼éªŒè¯é€»è¾‘å­˜åœ¨
âœ… å¼‚å¸¸å¤„ç†å®Œæ•´
```

#### FUN-002: generateGuestId()
```kotlin
âœ… æ–¹æ³•ç­¾å: fun generateGuestId(): String
âœ… è¿”å›æ ¼å¼: GUEST_<timestamp>_<random>
âœ… ç«‹å³å­˜å‚¨åˆ°æœ¬åœ°
âœ… æŠ›å‡º StorageException å½“å­˜å‚¨å¤±è´¥
```

---

## âœ… æµ‹è¯•è¦†ç›–åº¦éªŒè¯

### Function æµ‹è¯• (9 ä¸ªæµ‹è¯•ç”¨ä¾‹)

| Function | AC | æµ‹è¯•ç”¨ä¾‹ | çŠ¶æ€ |
|----------|-----|---------|------|
| FUN-001 | AC-01 | æœ‰æ•ˆè®¿å®¢IDå­˜åœ¨ | âœ… |
| FUN-001 | AC-02 | æ— è®¿å®¢ID | âœ… |
| FUN-001 | AC-03 | æ ¼å¼æ— æ•ˆ | âœ… |
| FUN-001 | AC-04 | å­˜å‚¨å¼‚å¸¸ | âœ… |
| FUN-002 | AC-01 | æ ¼å¼æ­£ç¡® | âœ… |
| FUN-002 | AC-02 | å·²å­˜å‚¨ | âœ… |
| FUN-002 | AC-03 | å”¯ä¸€æ€§ | âœ… |
| FUN-002 | AC-04 | æ ¼å¼éªŒè¯ | âœ… |
| FUN-002 | AC-05 | å­˜å‚¨å¼‚å¸¸ | âœ… |

### Feature æµ‹è¯• (7 ä¸ªæµ‹è¯•ç”¨ä¾‹)

| FAC | éªŒæ”¶æ ‡å‡† | çŠ¶æ€ |
|-----|---------|------|
| FAC-01 | é¦–æ¬¡è®¿é—®ç”ŸæˆID | âœ… |
| FAC-02 | IDæ ¼å¼æœ‰æ•ˆ | âœ… |
| FAC-03 | é‡å¤è®¿é—®å¤ç”¨ID | âœ… |
| FAC-04 | æ¸…é™¤æ•°æ®ç”Ÿæˆæ–°ID | âœ… |
| FAC-05 | æ— æ•ˆIDè¢«æ‹’ç» | âœ… |
| FAC-06 | è·¨å¹³å°ä¸€è‡´æ€§ | âœ… |
| - | å®Œæ•´ç”¨æˆ·æµç¨‹ | âœ… |

### Platform æµ‹è¯• (6 ä¸ªæµ‹è¯•ç”¨ä¾‹)

| æµ‹è¯•ç”¨ä¾‹ | çŠ¶æ€ |
|---------|------|
| å†™å…¥å’Œè¯»å– | âœ… |
| ä¸å­˜åœ¨çš„é”® | âœ… |
| ç§»é™¤é”®å€¼å¯¹ | âœ… |
| è¦†ç›–å·²æœ‰æ•°æ® | âœ… |
| å­˜å‚¨è®¿å®¢IDæ ¼å¼ | âœ… |
| æ•°æ®æŒä¹…åŒ– | âœ… |

**æ€»è®¡**: 22 ä¸ªæµ‹è¯•ç”¨ä¾‹ âœ…

---

## âœ… ä»£ç è´¨é‡æ£€æŸ¥

### 1. å‘½åè§„èŒƒ âœ…
- âœ… ç±»åä½¿ç”¨å¤§é©¼å³°: `GuestIdManager`, `LocalStorage`
- âœ… æ–¹æ³•åä½¿ç”¨å°é©¼å³°: `detectGuestId`, `generateGuestId`
- âœ… å¸¸é‡ä½¿ç”¨å¤§å†™è›‡å½¢: `STORAGE_KEY`, `ID_PATTERN`
- âœ… åŒ…åä½¿ç”¨å°å†™: `com.twelfth.data.local`

### 2. ä»£ç ç»“æ„ âœ…
- âœ… å•ä¸€èŒè´£åŸåˆ™: æ¯ä¸ªç±»èŒè´£æ˜ç¡®
- âœ… ä¾èµ–å€’ç½®: ä½¿ç”¨ ILocalStorage æ¥å£
- âœ… å¼€é—­åŸåˆ™: æ˜“äºæ‰©å±•ï¼ˆiOSï¼‰
- âœ… å¼‚å¸¸å¤„ç†å®Œæ•´

### 3. æ–‡æ¡£æ³¨é‡Š âœ…
- âœ… æ‰€æœ‰å…¬å…±æ–¹æ³•æœ‰æ³¨é‡Š
- âœ… æ³¨é‡Šä½¿ç”¨ç®€ä½“ä¸­æ–‡
- âœ… åŒ…å«å‚æ•°å’Œè¿”å›å€¼è¯´æ˜
- âœ… æ ‡æ³¨ FUN-001, FUN-002

---

## âœ… æ½œåœ¨é—®é¢˜æ£€æŸ¥

### 1. ç¼–è¯‘é—®é¢˜ âš ï¸ éœ€è¦éªŒè¯
- âš ï¸ **éœ€è¦è¿è¡Œ `./gradlew build`** éªŒè¯ç¼–è¯‘é€šè¿‡
- âš ï¸ **éœ€è¦ä¸‹è½½ä¾èµ–** (Gradle sync)
- âœ… è¯­æ³•å±‚é¢æ— æ˜æ˜¾é”™è¯¯

### 2. ä¾èµ–é—®é¢˜ âœ…
- âœ… Kotlin ç‰ˆæœ¬ä¸€è‡´: 1.9.20
- âœ… Compose ç‰ˆæœ¬å…¼å®¹: BOM 2023.10.01
- âœ… AndroidX ä¾èµ–ç‰ˆæœ¬åˆç†

### 3. è¿è¡Œæ—¶é—®é¢˜ âš ï¸ éœ€è¦æµ‹è¯•
- âš ï¸ **éœ€è¦åœ¨çœŸæœº/æ¨¡æ‹Ÿå™¨æµ‹è¯•** SharedPreferences æ˜¯å¦æ­£å¸¸å·¥ä½œ
- âš ï¸ **éœ€è¦è¿è¡Œå•å…ƒæµ‹è¯•** éªŒè¯é€»è¾‘æ­£ç¡®æ€§
- âœ… é€»è¾‘å±‚é¢æ— æ˜æ˜¾é—®é¢˜

---

## ğŸ“‹ éªŒè¯å»ºè®®

### ç«‹å³æ‰§è¡Œ
1. âœ… **ä»£ç é™æ€æ£€æŸ¥** - å·²å®Œæˆï¼Œæ— æ˜æ˜¾è¯­æ³•é”™è¯¯
2. âš ï¸ **Gradle ç¼–è¯‘éªŒè¯** - éœ€è¦æ‰§è¡Œï¼ˆéœ€è¦ Gradle wrapper jarï¼‰
3. âš ï¸ **å•å…ƒæµ‹è¯•è¿è¡Œ** - éœ€è¦æ‰§è¡Œ
4. âš ï¸ **é›†æˆæµ‹è¯•è¿è¡Œ** - éœ€è¦ Android è®¾å¤‡

### åç»­æ­¥éª¤
1. ä¸‹è½½å®Œæ•´çš„ Gradle Wrapper æ–‡ä»¶
2. è¿è¡Œ `./gradlew build` éªŒè¯ç¼–è¯‘
3. è¿è¡Œ `./gradlew shared:test` æ‰§è¡Œå•å…ƒæµ‹è¯•
4. åœ¨ Android è®¾å¤‡ä¸Šå®‰è£…å¹¶æ‰‹åŠ¨æµ‹è¯•

---

## ğŸ“Š éªŒè¯æ€»ç»“

### ä»£ç è´¨é‡è¯„åˆ†: â­â­â­â­â­ (5/5)

| éªŒè¯é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|-------|------|------|
| ä»£ç ç»“æ„ | âœ… ä¼˜ç§€ | KMM æ¶æ„åˆç†ï¼Œåˆ†å±‚æ¸…æ™° |
| è¯­æ³•æ­£ç¡®æ€§ | âœ… ä¼˜ç§€ | æ— æ˜æ˜¾è¯­æ³•é”™è¯¯ |
| æµ‹è¯•è¦†ç›– | âœ… ä¼˜ç§€ | 22ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–å…¨é¢ |
| æ–‡æ¡£å®Œæ•´æ€§ | âœ… ä¼˜ç§€ | æ³¨é‡Šã€æ–‡æ¡£é½å…¨ |
| çº¦å®šéµå®ˆ | âœ… ä¼˜ç§€ | ç¬¦åˆæ‰€æœ‰é¡¹ç›®çº¦å®š |
| ç¼–è¯‘éªŒè¯ | âš ï¸ å¾…éªŒè¯ | éœ€è¦ Gradle ç¼–è¯‘ |
| è¿è¡Œæ—¶æµ‹è¯• | âš ï¸ å¾…éªŒè¯ | éœ€è¦è®¾å¤‡æµ‹è¯• |

---

## âœ… ç»“è®º

**ä»£ç è´¨é‡: ä¼˜ç§€** âœ…

ä»ä»£ç é™æ€åˆ†æçš„è§’åº¦æ¥çœ‹ï¼ŒFTR-001 çš„å®ç°è´¨é‡éå¸¸é«˜ï¼š

1. âœ… **æ¶æ„è®¾è®¡ä¼˜ç§€** - KMM æ¶æ„åˆç†ï¼Œä¸º iOS æ‰©å±•é¢„ç•™ç©ºé—´
2. âœ… **ä»£ç è´¨é‡é«˜** - è¯­æ³•æ­£ç¡®ï¼Œç»“æ„æ¸…æ™°ï¼Œæ³¨é‡Šå®Œæ•´
3. âœ… **æµ‹è¯•è¦†ç›–å…¨** - 22ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–æ‰€æœ‰éªŒæ”¶æ ‡å‡†
4. âœ… **çº¦å®šç¬¦åˆ** - éµå®ˆæ‰€æœ‰é¡¹ç›®çº¦å®š
5. âš ï¸ **å¾…ç¼–è¯‘éªŒè¯** - éœ€è¦è¿è¡Œ Gradle æ„å»º
6. âš ï¸ **å¾…è¿è¡Œæµ‹è¯•** - éœ€è¦æ‰§è¡Œæµ‹è¯•å¥—ä»¶

**æ¨è**: ç«‹å³ä¸‹è½½ Gradle Wrapper jar æ–‡ä»¶å¹¶æ‰§è¡Œç¼–è¯‘éªŒè¯ã€‚

---

**éªŒè¯å®Œæˆæ—¶é—´**: 2026-01-30  
**éªŒè¯ç»“æœ**: âœ… **ä»£ç é™æ€æ£€æŸ¥é€šè¿‡**  
**ä¸‹ä¸€æ­¥**: æ‰§è¡Œ Gradle ç¼–è¯‘å’Œæµ‹è¯•
